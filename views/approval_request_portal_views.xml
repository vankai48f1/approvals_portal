<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="onnet_approvals_approval_request_form_view" model="ir.ui.view">
        <field name="name">onnet.approvals.approval.portal.view.form</field>
        <field name="model">approval.request</field>
        <field name="priority">9999</field>
        <field name="arch" type="xml">
            <form js_class="approval_portal_form_view" string="Request Portal" edit="True" create="True">
                <header>
                    <field name="user_status" invisible="1"/>
                    <field name="has_access_to_request" invisible="1"/>
                    <button name="action_confirm" string="Submit" type="object" invisible="not approver_ids or request_status != 'new'" class="btn-primary" data-hotkey="q"/>
                    <button name="action_approve" string="Approve" type="object" invisible="request_status in ['approved', 'refused', 'cancel'] or user_status != 'pending'" data-hotkey="v"/>
                    <button name="action_refuse" string="Refuse" type="object" invisible="request_status in ['approved', 'refused', 'cancel'] or user_status != 'pending'" data-hotkey="z"/>
                    <button name="action_withdraw" string="Withdraw" type="object" invisible="request_status == 'new' or user_status in ['waiting', 'pending', 'cancel'] or not user_status" data-hotkey="y"/>
                    <button name="action_draft" string="Back To Draft" type="object" invisible="request_status != 'cancel' or not user_status and not has_access_to_request" data-hotkey="w"/>
                    <button name="action_cancel" string="Cancel" type="object" invisible="request_status in ['new', 'cancel'] or not user_status and not has_access_to_request" data-hotkey="x"/>
                    <widget name="attach_document" string="Attach Document" action="message_post" invisible="attachment_number &lt; 1"/>
                    <widget name="attach_document" string="Attach Document" action="message_post" highlight="1" invisible="attachment_number &gt;= 1"/>
                    <field name="request_status" widget="statusbar"/>
                </header>
                <sheet>
                    <field name="has_date" invisible="1"/>
                    <field name="has_period" invisible="1"/>
                    <field name="has_quantity" invisible="1"/>
                    <field name="has_amount" invisible="1"/>
                    <field name="has_reference" invisible="1"/>
                    <field name="has_partner" invisible="1"/>
                    <field name="has_payment_method" invisible="1"/>
                    <field name="has_location" invisible="1"/>
                    <field name="has_product" invisible="1"/>
                    <field name="requirer_document" invisible="1"/>
                    <field name="approval_minimum" invisible="1"/>
                    <field name="approval_type" invisible="1"/>
                    <field name="change_request_owner" invisible="1"/>
                    <div class="o_not_full oe_button_box" name="button_box">
                        <button name="action_get_attachment_view" class="oe_stat_button" icon="fa-book" type="object" invisible="attachment_number == 0">
                            <field name="attachment_number" widget="statinfo" string="Documents" options="{'reload_on_button': true}"/>
                        </button>
                    </div>
                    <div class="oe_avatar">
                        <field name="category_image" widget="image" options="{'preview_image': 'category_image', 'size': [80, 80]}" class="bg-view"/>
                    </div>
                    <div class="oe_title">
                        <label for="name"/>
                        <h1>
                            <field name="automated_sequence" invisible="1"/>
                            <field name="name" placeholder="E.g: Expenses Paris business trip" required="1" readonly="automated_sequence"/>
                        </h1>
                    </div>
                    <group>
                        <group name="request_main">
                            <field name="request_owner_id" domain="[('share', '=', False)]" readonly="not change_request_owner or request_status != 'new'" widget="many2one_avatar_user"/>
                            <field name="category_id" readonly="request_status != 'new'" force_save="1"/>
                            <field name="date_confirmed" groups="base.group_no_one" readonly="1"/>
                            <label for="date" string="Date" invisible="has_date == 'no'"/>
                            <div invisible="has_date == 'no'">
                                <div>
                                    <field name="date" class="oe_inline" readonly="request_status != 'new'" required="has_date == 'required'"/>
                                </div>
                            </div>
                            <label for="date_start" string="Period" invisible="has_period == 'no'"/>
                            <div invisible="has_period == 'no'">
                                <div>
                                  <span>From: </span><field name="date_start" class="oe_inline" readonly="request_status != 'new'" required="has_period == 'required'"/>
                                </div>
                                <div>
                                  <span>to: </span><field name="date_end" class="oe_inline ms-4" readonly="request_status != 'new'" required="has_period == 'required'"/>
                                </div>
                            </div>
                            <field name="location" invisible="has_location == 'no'" readonly="request_status != 'new'" required="has_location == 'required'" placeholder="e.g. Brussels"/>
                            <field name="partner_id" invisible="has_partner == 'no'" readonly="request_status != 'new'" required="has_partner == 'required'"/>
                        </group>
                        <group name="request_details">
                            <field name="quantity" invisible="has_quantity == 'no' or has_product != 'no'" readonly="request_status != 'new'" required="has_quantity == 'required' and has_product == 'no'"/>
                            <field name="amount" invisible="has_amount == 'no'" readonly="request_status != 'new'" required="has_amount == 'required'"/>
                            <field name="reference" invisible="has_reference == 'no'" required="has_reference == 'required'"/>
                            <field name="company_id" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Products" name="products" invisible="has_product == 'no'">
                            <field name="product_line_ids" context="{'tree_view_ref': 'approvals.approval_product_line_view_tree', 'kanban_view_ref': 'approvals.approval_product_kanban_mobile_view'}" readonly="request_status != 'new'"/>
                        </page>
                        <page string="Description" name="description">
                            <field name="reason" readonly="request_status != 'new'"/>
                        </page>
                        <page string="Approver(s)" name="approvers">
                            <field name="approver_ids" mode="tree,kanban" readonly="request_status != 'new'">
                                <tree string="tree approval" editable="bottom" decoration-success="status=='approved'" decoration-warning="status in ['pending', 'waiting']" decoration-danger="status=='refused'" no_open="1">
                                    <field name="existing_request_user_ids" column_invisible="True"/>
                                    <field name="sequence" column_invisible="True"/>
                                    <field name="can_edit" column_invisible="True"/>
                                    <field name="can_edit_user_id" column_invisible="True"/>
                                    <field name="user_id" string="Approver" readonly="not can_edit_user_id or status != 'new'" force_save="1"/>
                                    <field name="required" readonly="not can_edit" force_save="1"/>
                                    <field name="status"/>
                                    <field name="company_id" column_invisible="True"/>
                                </tree>
                                <kanban class="o_kanban_mobile">
                                    <field name="company_id"/>
                                    <field name="user_id"/>
                                    <field name="status"/>
                                    <templates>
                                        <t t-name="kanban-box">
                                            <div class="oe_kanban_card oe_kanban_global_click">
                                                <div class="o_kanban_content">
                                                    <t t-esc="record.user_id.value"/>
                                                    <t t-if="record.status.raw_value">
                                                        <t t-set="classname" t-value="{'approved': 'text-bg-success', 'pending': 'text-bg-warning', 'refused': 'text-bg-danger'}[record.status.raw_value] || 'text-bg-light'"/>
                                                        <span t-esc="record.status.raw_value" t-attf-class="float-end rounded-pill {{ classname }}"/>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                                <form>
                                    <group>
                                        <field name="company_id" invisible="1"/>
                                        <field name="existing_request_user_ids" invisible="1"/>
                                        <field name="user_id"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="o_attachment_preview"/>
                <div class="oe_chatter">
                    <field name="message_follower_ids" groups="base.group_user"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="onnet_approvals_portal_request_view" model="ir.actions.act_window">
        <field name="name">Approval Portal</field>
        <field name="res_model">approval.request</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="onnet_approvals_approval_request_form_view" />
    </record>

</odoo>